#!/bin/bash -eupx
#-----------------------------------------------------------------------------
S=(v h csv fs abc)
A=(--vert --hori --csv --fs --abc)
P=ZZZ
# exit value if error (do 0 to just keep going...)
#-- E=1
E=0
#-----------------------------------------------------------------------------
I=(e)
#-----------------------------------------------------------------------------
rm -f ${P}.*
#-----------------------------------------------------------------------------
#-- clear
len=${#S[@]}
#-----------------------------------------------------------------------------
for i in ${I[@]}; do
    for (( j=0; j<$len; j++ )); do
    	s=${S[j]}
    	a=${A[j]}
	rm -f ${P}.ims.${s}.${i}
	rm -f ${P}.mus.${s}.${i}
	rm -f ${P}.diff.comp.${s}.${i}
	rm -f ${P}.diff.out.${s}.${i}
	gcc -E -x c -Wno-invalid-pp-token -undef -Wundef -Werror -nostdinc -C -CC ${i}.gcs -o ${i}.E
	~/ims/imscomp -D WHICH=0 ${a} ${i}.E ${i}.${s} > ${P}.ims.${s}.${i} 2>&1 || (echo ARGH imscomp ${i}.E ; exit $E)
	~/musicomp2abc/musicomp2abc -D WHICH=0 ${a} ${i}.E ${i}.${s} > ${P}.mus.${s}.${i} 2>&1 || (echo ARGH musicomp2abc ${i}.E ; exit $E)
	diff -u ${P}.mus.${s}.${i} ${P}.ims.${s}.${i} > ${P}.diff.comp.${s}.${i} || (echo ARGH diff ${i} mus/ims ${s} ; exit $E)
	echo "--- ${i} --- ${a} --- ${s} ---------------------------------------------------"
	cat ${P}.diff.comp.${s}.${i}
	diff -u ${i}.${s} ${i}.${s} > ${P}.diff.out.${s}.${i} || (echo ARGH ${i} comp-out ${s} ; exit $E)
	echo "------------------------------------------------------------------------------"
	cat ${P}.diff.out.${s}.${i}
    done
done
#-----------------------------------------------------------------------------
rm -f ${P}.*
#-----------------------------------------------------------------------------
exit 0
#-----------------------------------------------------------------------------
