#!/bin/bash -eup
#-----------------------------------------------------------------------------
S=(v h csv fs abc)
A=(--vert --hori --csv --fs --abc)
P=ZZZ
#-----------------------------------------------------------------------------
I=(inv15-example.working inv15-example loudness.mcomp promenade Aflatmajor b-6)
#-----------------------------------------------------------------------------
rm -f ${P}.*
#-----------------------------------------------------------------------------
clear
len=${#S[@]}
#-----------------------------------------------------------------------------
for i in ${I[@]}; do
    for (( j=0; j<$len; j++ )); do
    	s=${S[j]}
    	a=${A[j]}
	rm -f ${P}.ims.${s}.${i}
	rm -f ${P}.mus.${s}.${i}
	rm -f ${P}.diff.comp.${s}.${i}
	rm -f ${P}.diff.out.${s}.${i}
	gcc -E -x c -nostdinc -C -CC -Wno-error -Wno-extra -traditional-cpp ${i}.gcs -o ${i}.E
	~/ims/imscomp ${a} ${i}.E ${i}.${s} > ${P}.ims.${s}.${i} 2>&1 || (echo ARGH imscomp ${i}.E ; exit 1)
	~/musicomp2abc/musicomp2abc ${a} ${i}.E ${i}.${s} > ${P}.mus.${s}.${i} 2>&1 || (echo ARGH musicomp2abc ${i}.E ; exit 1)
	diff -u ${P}.mus.${s}.${i} ${P}.ims.${s}.${i} > ${P}.diff.comp.${s}.${i} || (echo ARGH diff ${i} mus/ims ${s} ; exit 1)
	echo "--- ${i} --- ${a} --- ${s} ---------------------------------------------------"
	cat ${P}.diff.comp.${s}.${i}
	diff -u ${i}.${s} ${i}.${s} > ${P}.diff.out.${s}.${i} || (echo ARGH ${i} comp-out ${s} ; exit 1)
	echo "------------------------------------------------------------------------------"
	cat ${P}.diff.out.${s}.${i}
    done
done
#-----------------------------------------------------------------------------
rm -f ${P}.*
#-----------------------------------------------------------------------------
exit 0
#-----------------------------------------------------------------------------
