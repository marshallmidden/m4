#!/bin/bash -ex
#-----------------------------------------------------------------------------
echo entering 12-libarchive
BINARIES="/home/m4/new-a"
#-----------------------------------------------------------------------------
prepath () {
    case ":$PATH:" in
      *":$1:"*) :;;         # in the middle
      "$1:"*) :;;           # at the end
      *":$1") :;;           # at the beginning
      "$1") :;;             # if only one
      *) PATH=$1:$PATH;;
    esac
}
prepath ${BINARIES}/bin
#-----------------------------------------------------------------------------
mkdir -p ${BINARIES}
J="-j 200"
#-----------------------------------------------------------------------------
if [ ! -d libarchive-3.5.0 ]; then
    if [ ! -f libarchive-3.5.0.tar.xz ]; then
	wget -N https://www.libarchive.org/downloads/libarchive-3.5.0.tar.xz
    fi
    tar xf libarchive-3.5.0.tar.xz
fi
#-----------------------------------------------------------------------------
cd libarchive-3.5.0
#-----------------------------------------------------------------------------
./configure --prefix=${BINARIES} 1>&2
#-----------------------------------------------------------------------------
make ${J}
#-----------------------------------------------------------------------------
make install
#-----------------------------------------------------------------------------
make clean || true
make distclean || true
#-----------------------------------------------------------------------------
ldconfig ${BINARIES}/lib
echo exiting 12-libarchive
exit 0
#-----------------------------------------------------------------------------
