#!/bin/bash -ex
#-----------------------------------------------------------------------------
echo entering 13-lua
BINARIES="/home/m4/new-a"
#-----------------------------------------------------------------------------
prepath () {
    case ":$PATH:" in
      *":$1:"*) :;;         # in the middle
      "$1:"*) :;;           # at the end
      *":$1") :;;           # at the beginning
      "$1") :;;             # if only one
      *) PATH=$1:$PATH;;
    esac
}
prepath ${BINARIES}/bin
#-----------------------------------------------------------------------------
mkdir -p ${BINARIES}
J="-j 200"
#-----------------------------------------------------------------------------
if [ ! -d lua-5.4.2 ]; then
    if [ ! -f lua-5.4.2.tar.gz ]; then
	wget -N https://www.lua.org/ftp/lua-5.4.2.tar.gz
    fi
    tar xf lua-5.4.2.tar.gz
fi
#-----------------------------------------------------------------------------
cd lua-5.4.2
#-----------------------------------------------------------------------------
make clean
#-----------------------------------------------------------------------------
make ${J} CFLAGS='-fPIE -fPIC -O3 -Wall -Wextra -DLUA_COMPAT_5_3 -DLUA_USE_LINUX'
#-----------------------------------------------------------------------------
make install
#-----------------------------------------------------------------------------
make clean || true
make distclean || true
#-----------------------------------------------------------------------------
ldconfig /home/m4/new-a/lib
#-----------------------------------------------------------------------------
echo exiting 13-lua
exit 0
#-----------------------------------------------------------------------------
