#!/bin/bash -ex
#-----------------------------------------------------------------------------
echo entering 01.GET.sources
BINARIES="/home/m4/new-a"
rm -rf ${BINARIES}/
mkdir -p ${BINARIES}
J="-j 200"
#=============================================================================
#=============================================================================
yum install -y popt-devel-1.13-16.el7.x86_64
yum install -y lua.x86_64
#=============================================================================
#=============================================================================
if [ ! -d gcc-10.2.0 ]; then
    if [ ! -f gcc-10.2.0.tar.xz ]; then
	wget -N http://ftp.gnu.org/gnu/gcc/gcc-10.2.0/gcc-10.2.0.tar.xz
    fi
    tar xf gcc-10.2.0.tar.xz
fi
( cd gcc-10.2.0 ; make clean || true ; make distclean || true )
#-----------------------------------------------------------------------------
if [ ! -d readline ]; then
    git clone https://git.savannah.gnu.org/git/readline.git
fi
( cd readline && ./configure && make ${J} && make install && ldconfig )
( cd readline ; make clean || true ; make distclean || true )
#-----------------------------------------------------------------------------
if [ ! -d gmp-6.2.0 ]; then
    if [ ! -f gmp-6.2.0.tar.xz ]; then
	wget -N http://ftp.gnu.org/gnu/gmp/gmp-6.2.0.tar.xz
    fi
    tar xf gmp-6.2.0.tar.xz
fi
( cd gcc-10.2.0 && ln -fs ../gmp-6.2.0 gmp )
( patch -p1 < GMP.patch ) || true
( cd gmp-6.2.0 ; make clean || true ; make distclean || true )
#-----------------------------------------------------------------------------
if [ ! -d mpfr-4.1.0 ]; then
    if [ ! -f mpfr-4.1.0.tar.xz ]; then
	wget -N http://ftp.gnu.org/gnu/mpfr/mpfr-4.1.0.tar.xz
    fi
    tar xf mpfr-4.1.0.tar.xz
fi
( cd gcc-10.2.0 && ln -fs ../mpfr-4.1.0 mpfr )
( cd mpfr-4.1.0 ; make clean || true ; make distclean || true )
#-----------------------------------------------------------------------------
if [ ! -d mpc-1.2.1 ]; then
    if [ ! -f mpc-1.2.1.tar.gz ]; then
	wget -N https://ftp.gnu.org/gnu/mpc/mpc-1.2.1.tar.gz
    fi
    tar xf mpc-1.2.1.tar.gz
fi
( cd gcc-10.2.0 && ln -fs ../mpc-1.2.1 mpc )
( cd mpc-1.2.1 ; make clean || true ; make distclean || true )
#-----------------------------------------------------------------------------
if [ ! -d binutils-2.35.1 ]; then
    if [ ! -f binutils-2.35.1.tar.xz ]; then
	wget -N http://ftp.gnu.org/gnu/binutils/binutils-2.35.1.tar.xz
    fi
    tar xf binutils-2.35.1.tar.xz
fi
( cd gcc-10.2.0 && ln -fs ../binutils-2.35.1 binutils )
( cd binutils-2.35.1 ; make clean || true ; make distclean || true )
#=============================================================================
#=============================================================================
if [ ! -d file-5.39 ]; then
    if [ ! -f file-5.39.tar.gz ]; then
        wget -N ftp://ftp.astron.com/pub/file/file-5.39.tar.gz
    fi
    tar xf file-5.39.tar.gz
fi
( cd file-5.39 ; make clean || true ; make distclean || true )
#-----------------------------------------------------------------------------
if [ ! -d libarchive-3.5.0 ]; then
    if [ ! -f libarchive-3.5.0.tar.xz ]; then
        wget -N https://www.libarchive.org/downloads/libarchive-3.5.0.tar.xz
    fi
    tar xf libarchive-3.5.0.tar.xz
fi
( cd libarchive-3.5.0 ; make clean || true ; make distclean || true )
#-----------------------------------------------------------------------------
if [ ! -d lua-5.4.2 ]; then
    if [ ! -f lua-5.4.2.tar.gz ]; then
        wget -N https://www.lua.org/ftp/lua-5.4.2.tar.gz
    fi
    tar xf lua-5.4.2.tar.gz
fi
( cd lua-5.4.2 ; make clean || true ; make distclean || true )
#-----------------------------------------------------------------------------
if [ ! -d rpm-4.16.1.2 ]; then
    if [ ! -f rpm-4.16.1.2.tar.gz ]; then
	wget -N http://ftp.rpm.org/releases/rpm-4.16.x/rpm-4.16.1.2.tar.bz2
    fi
    tar xf rpm-4.16.1.2.tar.bz2
    patch -p0 < RPM.configure.patch
fi
#-----------------------------------------------------------------------------
if [ ! -d db-4.5.20 ]; then
    if [ ! -f db-4.5.20.tar.gz ]; then
	wget -N http://download.oracle.com/berkeley-db/db-4.5.20.tar.gz
    fi
    tar xf db-4.5.20.tar.gz
fi
( cd rpm-4.16.1.2/ && ln -sf ../db-4.5.20 db )
#=============================================================================
#=============================================================================
echo exiting 01.GET.sources
exit 0
#-----------------------------------------------------------------------------
