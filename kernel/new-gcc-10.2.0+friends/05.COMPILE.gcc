#!/bin/bash -ex
#-----------------------------------------------------------------------------
echo entering 05.COMPILE.gcc
BINARIES="/home/m4/new-a"
mkdir -p ${BINARIES}
J="-j 200"
# J="-j 1"
#-----------------------------------------------------------------------------
export LDFLAGS="-L${BINARIES}/lib"
ldconfig ${BINARIES}/lib
#-----------------------------------------------------------------------------
rm -rf objdir
mkdir -p objdir

cd objdir
#-----------------------------------------------------------------------------
HERE=`pwd`
mkdir -p ${HERE}/binutils
mkdir -p ${HERE}/prev-binutils
ln -sf ${HERE}/binutils/binutils/ar binutils/ar
ln -sf ${HERE}/binutils/binutils/ranlib binutils/ranlib
ln -sf ${HERE}/binutils/binutils/nm-new prev-binutils/nm-new
ln -sf ${HERE}/binutils/binutils/ar binutils/ar
#-----------------------------------------------------------------------------
../gcc-10.2.0/configure \
    --prefix=${BINARIES} \
    --enable-languages=c,c++ \
    --disable-multilib \
    --with-gmp=/home/m4/new-a \
    --with-mpfr=/home/m4/new-a \
    --with-mpc=/home/m4/new-a
    \
    1>&2
#-----------------------------------------------------------------------------
echo entering 05.COMPILE.gcc bootstrap1
make ${J} bootstrap || true
#-----------------------------------------------------------------------------
mkdir -p ${HERE}/binutils
mkdir -p ${HERE}/prev-binutils
ln -sf ${HERE}/binutils/binutils/ar binutils/ar
ln -sf ${HERE}/binutils/binutils/ranlib binutils/ranlib
ln -sf ${HERE}/binutils/binutils/nm-new prev-binutils/nm-new
ln -sf ${HERE}/binutils/binutils/ar binutils/ar
echo entering 05.COMPILE.gcc bootstrap2
make ${J} bootstrap || true
#-----------------------------------------------------------------------------
mkdir -p ${HERE}/binutils
mkdir -p ${HERE}/prev-binutils
ln -sf ${HERE}/binutils/binutils/ar binutils/ar
ln -sf ${HERE}/binutils/binutils/ranlib binutils/ranlib
ln -sf ${HERE}/binutils/binutils/nm-new prev-binutils/nm-new
ln -sf ${HERE}/binutils/binutils/ar binutils/ar
echo entering 05.COMPILE.gcc bootstrap3
make ${J} bootstrap || true
#-----------------------------------------------------------------------------
mkdir -p ${HERE}/binutils
mkdir -p ${HERE}/prev-binutils
ln -sf ${HERE}/binutils/binutils/ar binutils/ar
ln -sf ${HERE}/binutils/binutils/ranlib binutils/ranlib
ln -sf ${HERE}/binutils/binutils/nm-new prev-binutils/nm-new
ln -sf ${HERE}/binutils/binutils/ar binutils/ar
echo entering 05.COMPILE.gcc bootstrap4
make ${J} bootstrap || true
#-----------------------------------------------------------------------------
mkdir -p ${HERE}/binutils
mkdir -p ${HERE}/prev-binutils
ln -sf ${HERE}/binutils/binutils/ar binutils/ar
ln -sf ${HERE}/binutils/binutils/ranlib binutils/ranlib
ln -sf ${HERE}/binutils/binutils/nm-new prev-binutils/nm-new
ln -sf ${HERE}/binutils/binutils/ar binutils/ar
echo entering 05.COMPILE.gcc bootstrap5
make ${J} bootstrap
#-----------------------------------------------------------------------------
echo exiting 05.COMPILE.gcc
exit 0
#-----------------------------------------------------------------------------
