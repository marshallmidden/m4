#!/bin/bash -ex
#-----------------------------------------------------------------------------
echo "Starting $0"
#-----------------------------------------------------------------------------
. 00-package-definitions
#=============================================================================
#=============================================================================
yum install -y popt-devel-1.13-16.el7.x86_64
yum install -y lua.x86_64
#=============================================================================
#=============================================================================
if [ ! -d ${VERSION_GCC} ]; then
    if [ ! -f ${VERSION_GCC}.tar.xz ]; then
	wget -N ${WHERE_GNU}/gcc/${VERSION_GCC}/${VERSION_GCC}.tar.xz
    fi
    tar xf ${VERSION_GCC}.tar.xz
fi
( cd ${VERSION_GCC} ; make clean || true ; make distclean || true )
#-----------------------------------------------------------------------------
if [ ! -d readline ]; then
    git clone ${MANY_PACKAGES}/readline.git
fi
( cd readline && ./configure && make ${J} && make install && ldconfig )
( cd readline ; make clean || true ; make distclean || true )
#-----------------------------------------------------------------------------
if [ ! -d ${VERSION_GMP} ]; then
    if [ ! -f ${VERSION_GMP}.tar.xz ]; then
	wget -N ${WHERE_GNU}/gmp/${VERSION_GMP}.tar.xz
    fi
    tar xf ${VERSION_GMP}.tar.xz
fi
( cd ${VERSION_GCC} && ln -fs ../${VERSION_GMP} gmp )
( cd ${VERSION_GMP} ; make clean || true ; make distclean || true )
#-----------------------------------------------------------------------------
if [ ! -d ${VERSION_MPFR} ]; then
    if [ ! -f ${VERSION_MPFR}.tar.xz ]; then
	wget -N ${WHERE_GNU}/mpfr/${VERSION_MPFR}.tar.xz
    fi
    tar xf ${VERSION_MPFR}.tar.xz
fi
( cd ${VERSION_GCC} && ln -fs ../${VERSION_MPFR} mpfr )
( cd mpfr-4.1.0 ; make clean || true ; make distclean || true )
#-----------------------------------------------------------------------------
if [ ! -d ${VERSION_MPC} ]; then
    if [ ! -f ${VERSION_MPC}.tar.gz ]; then
	wget -N ${WHERE_GNU}/mpc/${VERSION_MPC}.tar.gz
    fi
    tar xf ${VERSION_MPC}.tar.gz
fi
( cd ${VERSION_GCC} && ln -fs ../${VERSION_MPC} mpc )
( cd ${VERSION_MPC} ; make clean || true ; make distclean || true )
#-----------------------------------------------------------------------------
if [ ! -d ${VERSION_BINUTILS} ]; then
    if [ ! -f ${VERSION_BINUTILS}.tar.xz ]; then
	wget -N ${WHERE_GNU}/binutils/${VERSION_BINUTILS}.tar.xz
    fi
    tar xf ${VERSION_BINUTILS}.tar.xz
fi
( cd ${VERSION_GCC} && ln -fs ../${VERSION_BINUTILS} binutils )
( cd ${VERSION_BINUTILS} ; make clean || true ; make distclean || true )
#=============================================================================
#=============================================================================
if [ ! -d ${VERSION_FILE} ]; then
    if [ ! -f ${VERSION_FILE}.tar.gz ]; then
        wget -N ${WHERE_FILE}/${VERSION_FILE}.tar.gz
    fi
    tar xf ${VERSION_FILE}.tar.gz
fi
( cd ${VERSION_FILE} ; make clean || true ; make distclean || true )
#-----------------------------------------------------------------------------
if [ ! -d ${VERSION_LIBARCHIVE} ]; then
    if [ ! -f ${VERSION_LIBARCHIVE}.tar.xz ]; then
        wget -N ${WHERE_LIBARCHIVE}/${VERSION_LIBARCHIVE}.tar.xz
    fi
    tar xf ${VERSION_LIBARCHIVE}.tar.xz
fi
( cd ${VERSION_LIBARCHIVE} ; make clean || true ; make distclean || true )
#-----------------------------------------------------------------------------
if [ ! -d ${VERSION_LUA} ]; then
    if [ ! -f ${VERSION_LUA}.tar.gz ]; then
        wget -N ${WHERE_LUA}/${VERSION_LUA}.tar.gz
    fi
    tar xf ${VERSION_LUA}.tar.gz
fi
( cd ${VERSION_LUA} ; make clean || true ; make distclean || true )
#-----------------------------------------------------------------------------
if [ ! -d ${VERSION_RPM} ]; then
    if [ ! -f ${VERSION_RPM}.tar.gz ]; then
	wget -N ${WHERE_RPM}/${VERSION_RPM}.tar.bz2
    fi
    tar xf ${VERSION_RPM}.tar.bz2
    patch -p0 < RPM.configure.patch
fi
#-----------------------------------------------------------------------------
if [ ! -d ${VERSION_DB} ]; then
    if [ ! -f ${VERSION_DB}.tar.gz ]; then
	wget -N ${WHERE_DB}/${VERSION_DB}.tar.gz
    fi
    tar xf ${VERSION_DB}.tar.gz
fi
( cd ${VERSION_RPM}/ && ln -sf ../${VERSION_DB} db )
#=============================================================================
#=============================================================================
echo "Finishing $0"
exit 0
#-----------------------------------------------------------------------------
